import org.junit.Test;

import com.ust.diagram.manipulator.DiagramManipulator;

public class TestApp {

	@Test
	 public void testLeftSemiJoin()  {
	        String sql="abc -> ";
	        sql =sql.substring(0, sql.length()-5);

	        final String statement = "insert into rz_mbr  (  mbr_key   ,vrsn_open_dt   ,vrsn_clos_dt   ,mbrshp_sor_cd   ,src_grp_nbr   ,src_mbr_cd   ,sbscrbr_id   ,mbr_sqnc_nbr   ,mbr_orgnl_efctv_dt   ,mbr_rltnshp_cd   ,src_mbr_rltnshp_cd   ,frst_nm   ,last_nm   ,mid_init_nm   ,prfx_nm   ,sfx_nm   ,brth_dt   ,gndr_cd   ,src_gndr_cd   ,race_cd   ,src_race_cd   ,mrtl_stts_cd   ,src_mrtl_stts_cd   ,ssn  ,hc_id   ,medcr_nbr   ,mdcd_nbr   ,empi_id   ,indiv_rights_cd   ,hous_acct_cd   ,indrct_insrt_cd   ,rcrd_stts_cd  ,src_enrlmnt_id  ,load_log_key   ,sor_dtm   ,crctd_load_log_key   ,updtd_load_log_key   ,trnsctn_type_cd  ,load_sor_cd  ) select  mstg.mbr_key as mbr_key  ,current_date as vrsn_open_dt   ,'8888-12-31' as vrsn_clos_dt   ,mstg.mbrshp_sor_cd as mbrshp_sor_cd   ,trim(mstg.src_grp_nbr) as src_grp_nbr   ,mstg.src_mbr_cd as src_mbr_cd   ,mstg.src_sbscrbr_id as sbscrbr_id   ,case when mstg.mbrshp_sor_cd='815'   then mstg.src_mbr_cd   else mstg.src_mbr_sqnc_nbr  end as mbr_sqnc_nbr   ,'1111-01-01' as mbr_orgnl_efctv_dt   ,case when mstg.src_mbr_rltnshp_cd in('$csa2edw_clm_drvd_val','$csa2edw_clm_gap_val')   then mstg.mbr_rltnshp_cd  else  coalesce(xwk_mbr_rltnshp_cd.trgt_cd_val_txt,'$csa2edw_clm_dflt_val')  end as mbr_rltnshp_cd   ,mstg.src_mbr_rltnshp_cd as src_mbr_rltnshp_cd   ,mstg.src_mbr_frst_nm as frst_nm   ,mstg.src_mbr_last_nm as last_nm   ,mstg.src_mbr_mid_init_nm as mid_init_nm   ,'' as prfx_nm   ,'' as sfx_nm   ,mstg.src_mbr_brth_dt as brth_dt   ,case when mstg.src_mbr_gndr_cd in('$csa2edw_clm_drvd_val','$csa2edw_clm_gap_val')   then mstg.mbr_gndr_cd  else  coalesce(xwk_gndr_cd.trgt_cd_val_txt,'$csa2edw_clm_dflt_val')  end as gndr_cd   ,mstg.src_mbr_gndr_cd as src_gndr_cd   ,'na' as race_cd   ,'~na' as src_race_cd  ,'na' as mrtl_stts_cd   ,'~na' as src_mrtl_stts_cd   ,mstg.src_mbr_ssn as ssn  ,'unk' as hc_id    ,'na' as medcr_nbr   ,'unk' as medcr_nbr  ,'na' as mdcd_nbr  , case when mstg.mbrshp_sor_cd in ('808','868')  then 'unk'   else 'na' end as mdcd_nbr   ,'na' as empi_id   ,'na' as indiv_rights_cd   ,mstg.hous_acct_cd as hous_acct_cd   ,'1' as indrct_insrt_cd   ,'act' as rcrd_stts_cd   ,mstg.src_enrlmnt_id as src_enrlmnt_id  ,mstg.load_log_key as load_log_key   ,mstg.sor_dtm as sor_dtm   ,0 as crctd_load_log_key   ,mstg.load_log_key as updtd_load_log_key   ,'i' as trnsctn_type_cd  ,'na' as load_sor_cd from ( select cstg.mbr_key mbr_key ,max(cstg.mbrshp_sor_cd ) mbrshp_sor_cd ,case when cstg.clm_sor_cd='827'  then   case when (min(trim(substr(trim(cstg.prchsr_org_nbr),5,9))) = ''   or min(trim(substr(trim(cstg.prchsr_org_nbr),5,9))) = 'unk')  then max(trim(substr(trim(cstg.prchsr_org_nbr),5,9)))  else min(trim(substr(trim(cstg.prchsr_org_nbr),5,9)))  end else  case when (min(cstg.src_grp_nbr) = '' or min(cstg.src_grp_nbr) = 'unk')  then max(cstg.src_grp_nbr)  else min(cstg.src_grp_nbr)   end  end as src_grp_nbr ,case when (min(cstg.src_mbr_cd) = '' or min(cstg.src_mbr_cd) = 'unk') then max(cstg.src_mbr_cd) else min(cstg.src_mbr_cd) end as src_mbr_cd ,case when (min(cstg.src_sbscrbr_id) = '' or min(cstg.src_sbscrbr_id) = 'unk') then max(cstg.src_sbscrbr_id) else min(cstg.src_sbscrbr_id) end src_sbscrbr_id ,case when (min(cstg.src_mbr_sqnc_nbr) = '' or min(cstg.src_mbr_sqnc_nbr) = 'unk') then max(cstg.src_mbr_sqnc_nbr) else min(cstg.src_mbr_sqnc_nbr) end as src_mbr_sqnc_nbr ,case when (min(cstg.src_mbr_rltnshp_cd) = '' or min(cstg.src_mbr_rltnshp_cd) = 'unk') then max(cstg.src_mbr_rltnshp_cd) else min(cstg.src_mbr_rltnshp_cd) end as src_mbr_rltnshp_cd ,case when (min(cstg.mbr_rltnshp_cd) = '' or min(cstg.mbr_rltnshp_cd) = 'unk') then max(cstg.mbr_rltnshp_cd) else min(cstg.mbr_rltnshp_cd) end as mbr_rltnshp_cd ,case when (min(cstg.src_mbr_frst_nm) = '' or min(cstg.src_mbr_frst_nm) = 'unk') then max(cstg.src_mbr_frst_nm) else min(cstg.src_mbr_frst_nm) end as src_mbr_frst_nm ,case when (min(cstg.src_mbr_last_nm) = '' or min(cstg.src_mbr_last_nm) = 'unk') then max(cstg.src_mbr_last_nm) else min(cstg.src_mbr_last_nm) end as src_mbr_last_nm ,case when (min(cstg.mbr_gndr_cd) = '' or min(cstg.mbr_gndr_cd) = 'unk') then max(cstg.mbr_gndr_cd) else min(cstg.mbr_gndr_cd) end as mbr_gndr_cd ,max(cstg.clm_sor_cd) clm_sor_cd ,case when (min(cstg.src_mbr_mid_init_nm) = 'unk') then max(cstg.src_mbr_mid_init_nm) else min(cstg.src_mbr_mid_init_nm) end as src_mbr_mid_init_nm ,case when (max(cstg.src_mbr_brth_dt) = '8888-12-31') then min(cstg.src_mbr_brth_dt) else max(cstg.src_mbr_brth_dt) end as src_mbr_brth_dt ,case when (min(cstg.src_mbr_gndr_cd) = 'unk') then max(cstg.src_mbr_gndr_cd) else min(cstg.src_mbr_gndr_cd) end as src_mbr_gndr_cd ,case when (max(cstg.src_mbr_ssn) = 'unk') then min(cstg.src_mbr_ssn) else max(cstg.src_mbr_ssn) end as src_mbr_ssn ,case when (max(cstg.hous_acct_cd) = 'unk' or max(cstg.hous_acct_cd) = 'na' ) then min(cstg.hous_acct_cd) else max(cstg.hous_acct_cd)  end as hous_acct_cd ,case when (max(cstg.src_enrlmnt_id) = 'unk' or max(cstg.src_enrlmnt_id) = 'na' ) then min(cstg.src_enrlmnt_id) else max(cstg.src_enrlmnt_id) end as src_enrlmnt_id ,max(ell.load_log_key) load_log_key ,min(cstg.sor_dtm) sor_dtm  from pendd_clm_stg cstg  inner join csa_load_log cll  on cstg.load_log_key = cll.load_log_key  inner join   (select load_log_key  from edw_load_log  where load_strt_dtm   =  (select max(load_strt_dtm)  from edw_load_log  where pblsh_ind='n'   and subj_area_nm = '$csa2edw_clm_subj_area_nm'  and work_flow_nm = '$csa2edw_clm_work_flow_nm'  )  ) ell  on cll.edw_load_log_key = ell.load_log_key  left outer join mbr medw  on cstg.mbr_key = medw.mbr_key  left outer join rz_mbr rzm  on cstg.mbr_key = rzm.mbr_key  where rzm.mbr_key is null  and medw.mbr_key is null  group by cstg.mbr_key, cstg.clm_sor_cd ) mstg  left outer join cd_val_trnsltn xwk_mbr_rltnshp_cd   on xwk_mbr_rltnshp_cd.clmn_physcl_nm = 'mbr_rltnshp_cd'  and mstg.src_mbr_rltnshp_cd = xwk_mbr_rltnshp_cd.src_cd_val_txt  and xwk_mbr_rltnshp_cd.sor_cd = mstg.mbrshp_sor_cd  left outer join cd_val_trnsltn xwk_gndr_cd   on xwk_gndr_cd.clmn_physcl_nm = 'gndr_cd'  and mstg.src_mbr_gndr_cd = xwk_gndr_cd.src_cd_val_txt  and xwk_gndr_cd.sor_cd = mstg.mbrshp_sor_cd ; ";
	        DiagramManipulator parser=new DiagramManipulator();
	        sql="insert into rz_err_log (  tbl_nm  ,clmn_nm  ,sor_cd  ,src_key_clmn_data_txt  ,mapg_nm  ,err_msg_txt  ,err_rcrd_cnt  ,load_log_key  ,src_cd_id  ,trgt_cd_id ) select  tbl_nm  ,clmn_nm  ,sor_cd  ,src_key_clmn_data_txt  ,'clm_bteq_edw_clm_load' as mapg_nm  ,'rdm lookup not found' as err_msg_txt  ,count(src_key_clmn_data_txt)  ,load_log_key  ,coalesce(src_cd_id,0) as src_cd_id  ,coalesce(trgt_cd_id,0) as trgt_cd_id from (  select   src_key_clmn_data_txt  ,tbl_nm  ,clmn_nm  ,stg.sor_cd  ,load_log_key  ,xwalk.src_cd_id  ,xwalk.trgt_cd_id  from  (  select  case   when clmn_id = 1 then src_mbr_rltnshp_cd  when clmn_id = 2 then src_gndr_cd  end as src_key_clmn_data_txt  ,'mbr' as tbl_nm   ,case   when clmn_id = 1 then 'mbr_rltnshp_cd'  when clmn_id = 2 then 'gndr_cd'  end as clmn_nm  ,gtt.mbrshp_sor_cd as sor_cd  ,gtt.load_log_key as load_log_key  ,case   when clmn_id = 1 then mbr_rltnshp_cd  when clmn_id = 2 then gndr_cd  end as clmn_value  from   rz_mbr gtt   cross join  (  select clmn_id from lz_clmn_row_trnps where clmn_id <=2  ) clmn_row_trnps  ) stg  left outer join  (  select   sor_cd,  src_cd_id,  trgt_cd_id,  clmn_physcl_nm   from  cd_val_trnsltn   where  clmn_physcl_nm in   (   'mbr_rltnshp_cd','gndr_cd'  )  and src_cd_id <> 0  group by   sor_cd,  src_cd_id,  trgt_cd_id,  clmn_physcl_nm  ) xwalk  on  xwalk.sor_cd = stg.sor_cd   and  xwalk.clmn_physcl_nm = clmn_nm  where  stg.clmn_value = '$csa2edw_clm_dflt_val' ) error_table group by  tbl_nm  ,clmn_nm  ,sor_cd  ,mapg_nm  ,err_msg_txt  ,load_log_key  ,src_cd_id  ,trgt_cd_id  ,src_key_clmn_data_txt ;";
	       
	        
	       // parser.getGraph(sql);
	        
	        
	       // MainController m=new MainController();
	        //System.out.println("hello graph==="+m.getGraph(sql));
	        
	      //  assertEquals(1, plainSelect.getJoins().size());
	 }
    
	
	
}
